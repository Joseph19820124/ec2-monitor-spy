# 探子记 - 云端谍影 🕵️

> EC2 状态监控系统 —— 一个关于人机协作的技术故事

## 项目简介

这是一个用于监控 AWS EC2 实例状态的自动化系统。它像一个忠诚的"探子"，每隔 6 小时检查目标 EC2 的运行状态，并通过邮件向主人汇报。

**在线阅读完整故事：** [https://joseph19820124.github.io/ec2-monitor-spy/](https://joseph19820124.github.io/ec2-monitor-spy/)

## 背景

某日，主人配置了 EventBridge Scheduler 来定时开关一台 EC2 (large)：
- 每天 08:00 (上海时间) 开机
- 每天 18:00 (上海时间) 关机

但问题来了：如何验证这些定时任务是否正常执行？

于是，另一台永不休眠的 EC2 (singleton) 被赋予了"探子"的使命 —— 定期嗅探 large 的状态，并通过邮件汇报。

## 系统架构

```
┌──────────────────────────────────────────────────────────────────┐
│                           AWS Cloud                              │
│                                                                  │
│  ┌───────────────┐                       ┌───────────────┐       │
│  │   singleton   │ ───── Monitor ──────▶ │     large     │       │
│  │    (Scout)    │                       │   (Target)    │       │
│  │               │                       │               │       │
│  │ ┌───────────┐ │                       │  Scheduled:   │       │
│  │ │   Cron    │ │                       │  08:00 Start  │       │
│  │ │  6-hour   │ │                       │  18:00 Stop   │       │
│  │ └─────┬─────┘ │                       └───────────────┘       │
│  │       │       │                              ▲                │
│  │       ▼       │                              │                │
│  │ ┌───────────┐ │                       ┌──────┴──────┐         │
│  │ │  Monitor  │ │                       │ EventBridge │         │
│  │ │  Script   │ │                       │  Scheduler  │         │
│  │ └─────┬─────┘ │                       └─────────────┘         │
│  └───────┼───────┘                                               │
│          │                                                       │
│          ▼                                                       │
│  ┌───────────────┐        ┌───────────────┐                      │
│  │      SNS      │ ─────▶ │     Email     │ ─────▶  Master       │
│  │     Topic     │        │ Notification  │                      │
│  └───────────────┘        └───────────────┘                      │
│                                                                  │
└──────────────────────────────────────────────────────────────────┘
```

## 技术栈

| 组件 | 技术 |
|------|------|
| 云平台 | AWS (us-east-2) |
| 监控脚本 | Bash |
| 定时任务 | Cron |
| 通知服务 | AWS SNS |
| 文档网站 | GitHub Pages |

## 文件结构

```
monitor-ec2/
├── README.md              # 本文件
├── scripts/
│   └── check-ec2-status.sh   # 监控脚本
├── logs/
│   ├── monitor.log        # 监控日志
│   └── cron.log           # Cron执行日志
└── docs/
    └── index.html         # 故事网页 (GitHub Pages)
```

## 监控时间表

| 上海时间 | UTC 时间 | 预期 EC2 状态 | 说明 |
|---------|---------|--------------|------|
| 00:00 | 16:00 | stopped | 休息时段 |
| 06:00 | 22:00 | stopped | 休息时段 |
| 12:00 | 04:00 | running | 工作时段 |
| 18:00 | 10:00 | stopping/stopped | 关机时刻 |

## 邮件通知示例

```
🔍 探子来报

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
EC2 状态监控报告
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📅 检查时间: 2026-01-20 12:00:00 (上海时间)
🖥️ 目标实例: large (i-0a65e38615afa91ca)
📊 当前状态: running
⏰ 当前时段: 工作时段 (08:00-18:00)
🎯 预期状态: running
📋 判定结果: ✅ 符合预期

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

## 手动执行

```bash
# 立即执行一次状态检查
/home/ec2-user/joseph/proj/monitor-ec2/scripts/check-ec2-status.sh

# 查看监控日志
cat /home/ec2-user/joseph/proj/monitor-ec2/logs/monitor.log

# 查看 cron 任务
crontab -l
```

## 创作团队

本项目由 **Joseph** 与 **Claude (Anthropic)** 于 2026年1月20日亲密无间地协作完成。

从需求分析到架构设计，从代码编写到文学创作，人机配合，一气呵成。

---

*"云端双机各有司，探子六时报安危。人机协作无间道，一纸飞书万里驰。"*
